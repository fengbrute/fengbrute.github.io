---
title: 狼人杀运维日志
abbrlink: op.wolf
sage: true
categories:
  - 工作
  - 指上缤纷
  - 运维 
date: 2020-02-10 17:24:36
tags:
---
### 2020-03-04 星期四 7:30

#### 本次更新内容

##### 服务端：

1. 修复`tell`模块恢复是查表错误

##### 客户端：

无

#### 准备工作：

- [x] 发布维护公告
- [x] 提交代码

#### 更新步骤：

- [x] 内存快照`jmap -histo:live pid > /data/jmap_20200304.txt`
- [x] 执行更新脚本
- [x] 发补偿邮件

### 2020-03-03 星期二 7:30

#### 本次更新内容

##### 服务端：

1. 新版本落地（分表落地）
2. 修改邮件初始化红点
3. 统计日志用`worker`线程

##### 客户端：

无

#### 准备工作：

- [x] 发布维护公告
- [x] 同步最新的`mysql`到新数据库
- [x] 跑最新的建表语句
- [x] 修改`game.properties`中`mysql`数据库的配置
- [x] 恢复落地线程数为`cpu`核心数除2
- [x] 将线上所有`save`的`uid`导入3月2号的清理队列中
- [x] 将之前压测服链的`game.properties`中的`mysql`数据库配置去掉&去除`mysql`能力
- [x] 修改`wolfmaste`r服务器配置的`mysql`配置
- [x] 重启`wolfmaster`服务

#### 更新步骤：

- [x] 修改`log4j2`配置，将统计`log`分离出来
- [x] 内存快照`jmap -histo:live pid > /data/jmap_20200303.txt`
- [x] 执行更新脚本
- [x] 发补偿邮件

### 2020-02-27 星期四 7:43

#### 本次更新内容

##### 服务端：

1. 修正`playerData`为null的报错；

##### 客户端：

无

#### 准备工作：

无

#### 更新步骤：

- [x] 执行更新脚本

### 2020-02-27 星期四 7:30

#### 本次更新内容

##### 服务端：

1. 修正部分报错；
2. 修正缓存多线程问题；
3. 增加房间匹配算法的深度；
4. 去除统计模块的`mysql`能力，改为log

##### 客户端：

无

#### 准备工作：

- [x] 发维护公告
- [x] 新增`log4j2`的`stat`日志配置

#### 更新步骤：

- [x] 内存快照`jmap -histo:live pid > /data/jmap.txt`
- [x] 执行更新脚本

### 2020-02-26 星期三 8:25

#### 本次更新内容

##### 服务器端：

无

##### 客户端：

1. 更新客户端版本到`122`

#### 更新步骤：

- [x] 修改`gv`
- [x] 发布新版本

### 2020-02-26 星期三 7:30

#### 本次更新内容

##### 服务器端：

1. 升级`redis`
2. 升级`jdk`版本到最新
3. 更新已知`bug`

##### 客户端:

1. 更新`121`版本的`csv`配置


#### 更新步骤：

- [x] 停旧包并打包备份
- [x] 停新包
- [x] 更新客户端csv
- [x] 修改`jdk`版本
- [x] 升级`redis`到`16g`
- [x] 更新重启新包
- [x] 发补偿邮件
- [x] 停掉旧的监控，再`wolfapply2`开启新服务端口监控

### 2020-02-25 星期二  15:50

#### 本次更新内容

##### 服务器端：

1. 房间规则大改，新增我的房间，房间人气
2. 推荐房间算法修改
3. 实名认证&考试
4. 暂时只删除废玩家，不落地
5. 新增`save,user`两个表的时间戳列，根据插入和修改时间自增。
6. 已知部分`bug`修复

##### 客户端：

1. 客户端版本更新至121
2. 房间列表&我的房间修改
3. 实名认证&考试

#### 更新前准备：

- [x] 执行sql语句修改表`save`,`user`结构，增加时间戳列，并自动更新时间戳。
- [x] 新增表`tell`,`mail`,`friend`,`apply`,`roomuser`，并且加上时间戳
- [x] 检查`cleanModel`落地线程数量以及测试只删除废玩家不落地是否正常
- [x] 合并或者拉新的`master`分支看飞哥那边
- [x] 部署正式服对应的`svn`分支代码&修改配置&端口等
- [x] 修改`12345`端口服务的`java`内存配置
- [x] 开放服务器对应的安全组端口
- [x] 将旧包落地开关关掉！
- [x] 修改新包`ws`端口号为`12346`&`http`端口号为`7080`
- [x] 将旧包的消息订阅关闭

#### 更新步骤：

- [x] `dump`内存`jmap -dump:format=b,file=/data/heapdump.bin $pid`
- [x] 修改`gv`为`121`
- [x] 修改`sv`为`30`
- [x] 停审批服
- [x] 停旧包
- [x] 发布新版本
- [x] 修改旧包名为`wolf2_game3`将新包命名为`wolf2_game2`
- [x] 先启动新包
- [x] 再启动旧包
- [x] 发放补偿邮件(策划发)

### 2020-02-12 星期二 9:20

#### 本次更新内容：

##### 服务器：

无

##### 客户端：

1. 更新客户端版本至120
2. 解决狼人杀有概率不结算的问题

#### 更新步骤：

1. 停审批服
2. 修改gv为120(sv不需要修改)
3. 发布客户端版本

### 2020-02-11 星期二 9:00

#### 本次更新内容：

##### 服务器：

1. 修改了金币赛场的bug；
2. 修改房间排序的bug；
3. 限制init之前不处理任何命令；
4. 兼容玩家下线后仍然无法退出房间的脏数据；

##### 客户端：

1. 更新客户端版本至119
2. 客户端增加语音在线标志；
3. 客户端修正邀请进入房间的顺序问题。

#### 更新步骤：

1. 服务端停服
2. 发布客户端版本
3. 修改gv为119(sv不需要修改)
4. 更新重启服务端
5. 补偿邮件发放

### 2020-02-09 星期日 4:30

本次更新内容：

1. 开启落地开关

### 2020-02-08 星期六 10:00

本次更新内容：

1. 修改消息订阅线程数从原来的cpu核心数/2改为cpu核心数
2. 发布客户端118版本

### 2020-02-07 星期五 4:30

本次更新内容：

1. 因为落地有报错，所以关了落地开关重启了服务器

### 2020-02- 06 星期四 4:30

本次更新内容：

1. 修改落地线程数量从原来的cpu核心数*4，改为cpu核心数/2

### 2020-02-05 星期三 10:42

本次更新内容：

1. 更新后游戏增加金币模式（试运行）
2. 游戏同时修改了大量已知bug 
3. 降低了一些游戏道具价格
4. 发布新版客户端117

### 2020-01-30 星期四 4:30

本次更新内容：

1. 升级redis从8g到12g

### 2020-01-27 星期日 4:30

本次更新内容：

1. 切换至16c 64g的服务器
2. 程序&配置部分未作修改